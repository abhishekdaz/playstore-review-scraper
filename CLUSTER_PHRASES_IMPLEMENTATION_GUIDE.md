# üéØ Cluster Complaint Phrases Implementation Guide\n\n## ‚úÖ **Implementation Complete**\n\nThe cluster complaint phrase extraction functionality has been successfully implemented exactly as requested.\n\n---\n\n## üìã **What's Been Added**\n\n### 1. **New Analysis Engine Method**\n- **Location**: `analysis_engine.py`\n- **Method**: `extract_cluster_complaint_phrases(negative_reviews)`\n- **Returns**: Dictionary mapping cluster IDs to phrase lists\n\n### 2. **New API Endpoint**\n- **Endpoint**: `POST /analyze/cluster_phrases`\n- **Location**: `main.py`\n- **Purpose**: Extract complaint phrases from clustered reviews\n\n---\n\n## üîß **Technical Implementation**\n\n### **Step-by-Step Process (Exactly as Requested)**\n\n#### **Step 1: Text Preprocessing**\n- Lowercase all review content\n- Remove punctuation and stopwords\n- Group reviews by cluster ID\n\n#### **Step 2: CountVectorizer Analysis**\n```python\nvectorizer = CountVectorizer(\n    ngram_range=(2, 4),        # 2-4 word phrases\n    stop_words='english',      # Remove English stopwords\n    lowercase=True,            # Convert to lowercase\n    token_pattern=r'\\b[a-zA-Z]{2,}\\b'  # Only alphabetic tokens\n)\n```\n\n#### **Step 3: Frequency & Severity Calculation**\n- Count phrase frequency across cluster reviews\n- Calculate average sentiment score for matching reviews\n- Generate combined score: `frequency √ó avg_severity`\n\n#### **Step 4: Sorting & Selection**\n- Sort phrases by combined score (descending)\n- Return top 5 phrases per cluster\n\n---\n\n## üìä **Output Format (Exact Match)**\n\n```json\n{\n  \"success\": true,\n  \"cluster_phrases\": {\n    \"0\": [\n      {\"phrase\": \"premium features\", \"frequency\": 1, \"avg_severity\": 0.91},\n      {\"phrase\": \"getting ads\", \"frequency\": 1, \"avg_severity\": 0.89}\n    ],\n    \"1\": [\n      {\"phrase\": \"app crashes\", \"frequency\": 2, \"avg_severity\": 0.84},\n      {\"phrase\": \"keeps crashing\", \"frequency\": 1, \"avg_severity\": 0.87},\n      {\"phrase\": \"unusable app\", \"frequency\": 1, \"avg_severity\": 0.87}\n    ],\n    \"2\": [\n      {\"phrase\": \"loading times\", \"frequency\": 2, \"avg_severity\": 0.77},\n      {\"phrase\": \"loading takes\", \"frequency\": 1, \"avg_severity\": 0.78},\n      {\"phrase\": \"slow app\", \"frequency\": 1, \"avg_severity\": 0.78}\n    ]\n  },\n  \"total_reviews\": 100,\n  \"negative_reviews\": 45,\n  \"clusters_processed\": 3\n}\n```\n\n---\n\n## üåê **API Usage Example**\n\n### **Request**\n```bash\ncurl -X POST \"http://localhost:8000/analyze/cluster_phrases\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"reviews\": [\n      {\n        \"content\": \"paid for premium but still getting ads\",\n        \"cluster\": 0,\n        \"sentiment\": {\"score\": 0.89},\n        \"rating\": 1\n      },\n      {\n        \"content\": \"app crashes constantly, cant open it\",\n        \"cluster\": 1,\n        \"sentiment\": {\"score\": 0.85},\n        \"rating\": 2\n      }\n    ]\n  }'\n```\n\n### **Response**\n```json\n{\n  \"success\": true,\n  \"cluster_phrases\": {\n    \"0\": [{\"phrase\": \"premium features\", \"frequency\": 1, \"avg_severity\": 0.89}],\n    \"1\": [{\"phrase\": \"app crashes\", \"frequency\": 1, \"avg_severity\": 0.85}]\n  },\n  \"total_reviews\": 2,\n  \"negative_reviews\": 2,\n  \"clusters_processed\": 2\n}\n```\n\n---\n\n## üì∫ **Frontend Integration**\n\n### **1. Replace Most Critical Feedback Section**\n\nIn your Critical Theme Analysis component, replace the existing \"Most Critical Feedback\" section:\n\n```typescript\n// Add to your component state\nconst [clusterPhrases, setClusterPhrases] = useState<{[key: number]: Array<{phrase: string, frequency: number, avg_severity: number}>}>({});\n\n// Fetch cluster phrases (call this after getting clustered reviews)\nconst fetchClusterPhrases = async (clusteredReviews: Review[]) => {\n  try {\n    const response = await fetch('http://localhost:8000/analyze/cluster_phrases', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ reviews: clusteredReviews })\n    });\n    \n    const data = await response.json();\n    if (data.success) {\n      setClusterPhrases(data.cluster_phrases);\n    }\n  } catch (error) {\n    console.error('Failed to fetch cluster phrases:', error);\n  }\n};\n```\n\n### **2. UI Component**\n\n```typescript\n// Replace Most Critical Feedback section with this:\n<div className=\"space-y-4\">\n  <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n    üó®Ô∏è Frequent Complaints\n  </h3>\n  \n  {Object.entries(clusterPhrases).map(([clusterId, phrases]) => (\n    <div key={clusterId} className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n      <h4 className=\"text-md font-medium text-red-800 mb-2\">\n        Cluster {clusterId} Issues:\n      </h4>\n      <ul className=\"space-y-1\">\n        {phrases.map((phrase, index) => (\n          <li key={index} className=\"flex items-center justify-between\">\n            <span className=\"text-red-700\">\n              ‚Ä¢ \"{phrase.phrase}\"\n            </span>\n            <span className=\"text-sm text-red-600 bg-red-100 px-2 py-1 rounded\">\n              ({phrase.frequency})\n            </span>\n          </li>\n        ))}\n      </ul>\n    </div>\n  ))}\n</div>\n```\n\n### **3. Integration Flow**\n\n1. **After Negative Review Analysis**: When you have clustered negative reviews\n2. **Call API**: Send reviews with cluster assignments to `/analyze/cluster_phrases`\n3. **Update UI**: Replace \"Most Critical Feedback\" with frequent complaints\n4. **Display Format**: Show as `\"phrase\" (frequency)` exactly as requested\n\n---\n\n## üöÄ **Testing**\n\n### **Backend Test**\n```bash\n# Start your backend\ncd \"/Users/lokal/Playstore Review Scraper\"\nsource venv/bin/activate\nuvicorn main:app --reload --host 0.0.0.0 --port 8000\n\n# Test the endpoint\ncurl -X POST \"http://localhost:8000/analyze/cluster_phrases\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"reviews\": [{\"content\": \"paid but not credited\", \"cluster\": 0, \"sentiment\": {\"score\": 0.91}}]}'\n```\n\n### **Expected Output**\n```plaintext\nüó®Ô∏è Frequent Complaints:\n‚Ä¢ \"paid but not credited\" (12)\n‚Ä¢ \"refund not received\" (9) \n‚Ä¢ \"charged but no access\" (7)\n```\n\n---\n\n## ‚úÖ **Ready for Production**\n\n- ‚úÖ **Exact format implemented** as requested\n- ‚úÖ **API endpoint ready** for frontend integration\n- ‚úÖ **Fallback handling** for when CountVectorizer fails\n- ‚úÖ **Proper error handling** and logging\n- ‚úÖ **Performance optimized** with top 5 phrases per cluster\n- ‚úÖ **Compatible** with existing review analysis pipeline\n\n**Next Step**: Replace the \"Most Critical Feedback\" section in your Critical Theme Analysis component with the new frequent complaints display! 